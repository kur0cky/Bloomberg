\documentclass[11pt]{jreport}
\usepackage[dvipdfmx, hiresbb]{graphicx}
\usepackage[top=30truemm, bottom=30truemm, left=30truemm, right=30truemm]{geometry}
\usepackage{float}
\usepackage{ascmac}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{amsfonts}
\usepackage{here}
\begin{document}
\title{ファクター・リスク寄与度に基づくポートフォリオの構築について\\}
\author{東京理科大学工学部経営工学科 \quad 黒木 裕鷹 \and 東京理科大学工学部経営工学科 \quad 小坪 琢人 \and 東京理科大学工学部経営工学科 \quad 永井 直哉}
\maketitle
\begin{abstract}

運用期間が1 $\sim$ 数カ月程度の短期間投資でパフォーマンスを得るために，近年盛んに研究されているマルチ・ファクターモデルを用いたポートフォリオを構築した．
しかし，Fama-Frenchの3ファクターモデルをはじめとするマルチ・ファクターモデルには，ファクターの数を増やすことによる多重共線性の問題やオーバーフィッティングの問題があった．
このように，ファクターモデルの構築において重要な課題となる，適切なファクター選択やそれらの相関の与える影響を考慮した独自のモデル推定を試みた．
時系列データの性質上，新たに観測されるデータは常に将来のものであり，これはいわゆる外挿の一種である．
そのため，時系列に関するモデリングではモデルの複雑化にともなうオーバーフィッティングの影響を非常に受けやすい．
この問題を解決するため，モデル推定では近年パターン認識の分野でしきりに利用されているlasso回帰を用いた．
また，共通要因が株価に与える影響は時系列的に変動するため，最適なモデルの選択には交差検証法を用いた．
推定したマルチ・ファクターモデルからファクター・リターンに対する銘柄の影響度を推定し，特異なパフォーマンスを示す銘柄を投資対象としてポートフォリオに組み込む手法を提案した．

運用戦略のバックテストでは，提案したマルチ・ファクターモデルと手法を用いて構築したポートフォリオが長期的に安定してベンチマーク（日経225やTOPIX）をアウトパフォームする結果となった． 
これはファクターのリスク・プレミアムを上手く抽出できた結果であると考えられ，同様の戦略によるポートフォリオを提出した．
\end{abstract}










\chapter{はじめに}
株価の変動は，その企業に固有の経営状況を示す財務諸表や業種等おファンダメンタルズに依る部分や，市場参加者の期待が反映された部分などにより説明される．
株価の将来価格の予測は，
1) ファンダメンタルズ分析に基づく手法\quad
2) 株価変動の時系列特性から変動パターンを抽出し，将来価格の予測に用いるテクニカル分析\quad
3)統計モデルによる手法\quad
が代表的な取り組みである．
このようにアプローチの仕方は様々であるが，起業や投資家にとって，将来の株価予測モデルの構築は金融資産のリスク管理や運用上重要な課題である．
本レポートでは無裁定価格理論(APT)による株価収益率モデルを構築し，ポートフォリオ運用に応用する．

\section{Bloomberg投資コンテスト}
本コンテストで行うシミュレーションは一般的に行われている金融取引とは異なる．最終的な目標は一定のルールのもとでより高い収益を獲得することであるため，投資の戦略もルールに基づいたものでなくてはならない．ルールを概観し，以下にまとめた．

\begin{enumerate}
\item ルール
\begin{enumerate}
\item ポートフォリオ登録時点で時価総額が1億円以内になるように登録
\item 10銘柄以上、30銘柄以下でのポートフォリオを構成
\item 2017年7月31日までであれば1度だけ銘柄の入れ替え(リバランス)が可能
\item ロングポジションのみ（空売り禁止）
\item 手数料は考慮しない
\end{enumerate}

\item パフォーマンス計測期間
\begin{enumerate}
\item  2017年7月3日 $\sim$ 2017年8月31日
\end{enumerate}

\item パフォーマンス測定方法
\begin{enumerate}
\item ポートフォリオ機能「トータルリターン(\%)」を頻度日次・円建てで計測
\item ポートフォリオ登録は登録日より2営業日前の終値をコスト価格として登録
\item ポートフォリオ登録後、6月中の価格変動による時価総額の増減を含め7月3日から8月31日の間でパフォーマンスを計測
\end{enumerate}
\end{enumerate}

以上のルールの中で，時間的な制約は1-c, 2-aである．これらにより1か月単位のバイアンドホールドを強いられ，さらにルール3-bにより裁定機会が失われることになる．つまり，金融資産の価格変動は何を根拠として起こっているのか，という視点で考える必要があり，それに基づいて価格が上昇する銘柄を追い求めていくことになる．次節では，価格変動の源泉について考察した．

\section{価格変動の源泉}


金融資産は一般的な商品と異なり，投資目的やリスクヘッジ目的で購入されることがほとんどであるため，その価格は需要供給の関係だけでなく価格変動の予想にも影響される．
株式市場が効率的であるという効率的市場仮説の立場では，あらゆる「情報」が株価形成に反映されているはずであるため，将来価格の予測は不可能ということになる．
%証券投資理論を見て加筆する???
一方，テクニカル分析に基づく株価予測モデルは，株価の将来価格は過去の変動パターンから予測可能であるという立場を取る．
一般の投資家は株式市場で適切な価格形成が行われているか十分な情報を得ることが出来ないため，高度に習熟したプロフェッショナル（証券アナリストや裁定取引を行う投資家など）による株価予測が有益な情報となる．
一方アナリストによる予測は広く投資家間で共有され，株価上昇が見込まれる銘柄に買いが集まるかもしれない．
そこで本研究では，アナリストやテクニカル指標による株価予測の情報は，
1) 検証することが困難\quad
2) バイアンドホールドによる運用には向かない\quad
などの理由から考察の対象としない．
つまり，効率的市場仮説の立場に基づき，「情報」に着目するような投資戦略は取らないこととした．
%これでいいの???

\section{資本資産価格モデル(CAPM)}
世界には無数の企業が存在し，それぞれが異なった性質を持っている．
経営方針や持っている技術，リリースしている商品，組織体系などが多種多様であるためだ．
しかし，複数の企業に共通している性質も考えられる．
例えば所属国や業種，企業の規模などだ．
このような共通の要因のうち，株価の変動に関係を持つものも当然存在するだろう．

資産価格変動の共通要因を考えた理論として最も広く知られているのはウィリアム・シャープらによる資本資産価格モデル(capital asset pricing model : CAPM)だろう．
市場ポートフォリオを唯一の共通要因とした資産価格の評価手法である．
CAPMは1960年代より不動の地位を築き，その計算の簡便さもあり現在でも広く用いられている．
しかし1970年代以降，CAPMに対する様々な批判や問題点が提起され，代わりとなる新たな理論が提唱され続けてきた．
2章で触れるが，CAPMが必要とする仮定が非常に限定的であり，到底成立するものではない，という主張である．
そこで，本研究ではより確からしい共通要因を考えるため，独自のマルチ・ファクターモデルを構築することとした．

マルチ・ファクターモデルで最も知られているのはFama-Frenchの3ファクターモデル\cite{Fama}だろう．
ファーマとフレンチは米市場における実証分析を行い，企業規模(Size)や簿価比時価率(Value)が株価の収益構造に関与していると結論付けた．
企業規模の小さい銘柄や，時価総額が総資産額に比べて割安な銘柄は平均的に高い収益を見せることを示したのである．
この現象はそれぞれ小型株効果，バリュー株効果と呼ばれ，代表的なアノマリーとして認識されている．
ファーマとフレンチはその功績により2013年にノーベル経済学賞を受賞している．
実際に似たような性質(業種や企業規模など)の銘柄は似たような価格変動を見せることが多く，FamaとFrenchが対象とした米市場に限らず，金融資産の価格変動が共通の要因に影響されているという主張は自然なものだと考えられる．

また，ファクターモデルと密接に関わる理論としてステファン・ロスの無裁定価格理論(APT)\cite{Ross}がある．
APTはCAPMと異なり，全資産の収益の同時分布が正規分布であることを必要しない．
APTが必要とする仮定は，「投資家はただ飯をいくらでも食べたがる」という，ほぼ自明の行動原理のみである\cite{analyst}．
そのためAPTはCAPMよりも柔軟な理論であるといえる．

\section{戦略の決定}

市場には無数の裁定取引を行う投資家が存在すること，さらにコンテストのルールにより，鞘取りに関しては全く行うことが出来ない．
このことは市場に裁定機会が存在しないことを主な仮定とするAPTと非常に相性の良いものであり，本コンテストのルールの下で収益を出すために十分有用であると考えられる．
独自のマルチ・ファクターモデルを構築し，「直近で平均的に勝てている投資スタイル」を見つけ出すことが出来れば2ヶ月間の収益を競う本コンテストにおいても成果を上げることが出来るのではないかと考えた．
マルチ・ファクターモデルとAPTにより，CAPMよりも確からしい資産の価格変動の構造を考え，確かな運用手法を提案することを目標にする．
また，本コンテストは2カ月間のみの短いものであり，偶発的な金融危機については考えないこととする．
とはいえ収益に見合わないリスクを持つポートフォリオを構成することには利点がないため，特に理由がない限り構成銘柄数は最大の30銘柄を考える．

マルチ・ファクターモデルにより各銘柄の収益構造を推定した後の問題はポートフォリオに組み込む資産をどのように選択するかである．
投資には必ずリスクが伴い，投資家はそのリスクを代償にリターンを求める．
そこでここでは，それぞれのファクターの持つリスクに晒される「価値」を考えることとした．
この「価値」は通常リスク・プレミアムと呼ばれる．高いリスク・プレミアムを持つファクターに対してリスクを取り，低いリスク・プレミアムを持つファクターに対して分散化することを考えていく．

\subsection{レポート構成}
本レポートの2章ではポートフォリオ構築に使用した諸理論や既存のモデルを体系だてて述べる．
3章では実際に行ったデータ解析の手順を述べ，バックテストの結果と共に提案する手法を示す．
4章では提出したポートフォリオの途中経過を示し，行ったリバランスについても触れる．
5章では提案手法に対する課題の提示と，まとめを行う．











\chapter{ファクターモデルに基づくポートフォリオ選択}
\section{シングル・ファクターモデルとしてのCAPM}
市場を構成する資産数を$N$とする．CAPMの枠組みにおいて，金融資産$i$の収益率$r_i$は唯一の共通要因である市場ポートフォリオの収益率$R_M$に依存する変動と資産特有の変動$\varepsilon_i$に分けられ，以下のように表される．また，$\varepsilon_i$は資産間で相互に無相関であると仮定される．$r_f$は無リスク利子率を表す定数であり，信用の高い長期国債の年利が一般的に用られる．
\begin{equation}
\begin{split}
&r_i - r_f = \alpha_i + \beta_i(R_M - r_f) + \varepsilon_i,\qquad(i=1,\cdots,N)\\
&\varepsilon_i \sim i.i.d.N(0,\sigma_i^2),\\
&Cov(R_M, \varepsilon_i) = 0,\\
&Cov(r_i, r_j) = 0, \qquad (i \neq j)
\label{eq:CAPM}
\end{split}
\end{equation}
ここで，$\beta_i$は金融資産$i$の市場ポートフォリオへの感度を表し，$\alpha_i$は市場ポートフォリオに対する期待超過収益率を表している．式(\ref{eq:CAPM})より$r_i$の分散を求めると
\begin{equation}
Var(r_i) = \beta_i^2Var(R_M) + Var(\varepsilon_i) \qquad (\text{∵}Cov(R_M, \varepsilon_i) = 0)
\label{eq:CAPM_var}
\end{equation}
となり，この右辺第1項はシステマティック・リスクと呼ばれ，シングル・ファクターであるマーケットの動きにより説明可能な部分である．
また右辺第2項はマーケットに依存しないアンシステマティック・リスクと呼ばれる．
これらのリスクのうち，アンシステマティック・リスクはポートフォリオ選択によって除去可能であるとしばしば言われる．このことを見るために，式(\ref{eq:CAPM})により記述される資産で空売りをせずに構成したポートフォリオを考える．資産$i(i=1,\cdots,N)$の保有比率が$w_i$であるようなポートフォリオ$P$の収益率$R_P$は以下で与えられることになる．ただし，$\sum_{i=1}^N = 1$である．
\begin{equation}
\begin{split}
R_P &= \alpha_P + \beta_PR_M + \varepsilon_P\\
&= \sum_{i=1}^N w_i\alpha_i
+\left(\sum_{i=1}^N w_i\beta_i\right)R_M
+\sum_{i=1}^N w_i\varepsilon_i
\end{split}
\end{equation}
また，このポートフォリオの分散は以下で与えられる．
\begin{equation}
\begin{split}
Var(R_P) &= \beta_P^2 Var(R_M) + Var(\varepsilon_P)\\
& = \left(\sum_{i=1}^N w_i\beta_i\right)^2Var(R_M) + \sum_{i=1}^N w_i^2 Var(\varepsilon_i)
\label{eq:var_port}
\end{split}
\end{equation}
この$\beta_P$がポートフォリオの市場ポートフォリオに対する感度になり，$\alpha_P$がポートフォリオの市場ポートフォリオに対する期待超過収益率となる．ここで，式(\ref{eq:var_port})の右辺第2項がポートフォリオのアンシステマティック・リスクである．$0\leq w_i \leq 1$であることより，以下の式が成立する．
\begin{equation}
\sum_{i=1}^N w_i^2Var(\varepsilon_i) \leq \sum_{i=1}^N w_iVar(\varepsilon_i)
\end{equation}
つまり，アンシステマティック・リスク$Var(\varepsilon_i)$が銘柄ごとに大差ない場合，十分分散化されたポートフォリオのアンシステマティック・リスクは非常に小さくなる．



\section{CAPMに対する批判}
1.4節で述べたように，CAPMに対しては様々な批判が為され，実証分析が行われてきた．以下にその代表的なものを挙げる．
\begin{itemize}
\item Basu(1977)\cite{Basu}\\
ニューヨーク証券取引所において，株価収益率(PER)の低い銘柄が高い銘柄に比べて良いパフォーマンスを見せることを実証した．
\item Rolf Banz(1981)\cite{Banz}\\
企業規模の小さい銘柄が大きい銘柄に比べて良いパフォーマンスを見せることを実証した．
\item Jagadeesh, Titman(1993)\cite{Jagadeesh}\\
モメンタムの強い銘柄が市場をけん引し続ける傾向があることを実証した．
\end{itemize}

式(\ref{eq:CAPM_var})の第2項であるアンシステマティック・リスクはポートフォリオ選択によって除去可能であると言われてきたが，これが不可能であることをいずれの研究も示している．企業特有の$\varepsilon_i$が企業ごとに独立ではなく，共分散が存在しているということである．つまりこのことは，マーケットではない共通要因も存在し，それらがアノマリーの原因となっていることを示唆している．CAPMの枠組みでは，市場ポートフォリオによって説明できる部分(ベータ)と出来ない部分(アルファ)に分けられ，超過収益であるアルファはポートフォリオ・マネージャーの手腕によるものたと解釈された．しかし次節で述べるマルチ・ファクターモデルの発見により，マネージャーの手腕によると言える部分は徐々に減り，代わりにファクターのリスク・プレミアムによる部分が増えることとなった．

以下の図\ref{fig:beta}にそのイメージを示した．
左から1番目の棒グラフはポートフォリオ収益率全体を表している．2番目の棒グラフはCAPMの枠組みにおける$R_P=\alpha_P + \beta_PR_M$，3番目は$R_P = \alpha_P + \beta_{market}F_{market} + \beta_{size}F_{size}$，4番目は$R_P = \alpha_P + \beta_{market}F_{market} + \beta_{size}F_{size} + \beta_{value}F_{value}$とモデル化したときの収益構造のイメージ図である．

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=14cm]{./fig/beta}
		\caption{ベータの移り変わり}
		\label{fig:beta}
	\end{center}
\end{figure}




\section{マルチ・ファクターモデル}
ここでは，各資産の収益率が$m$個の共通要因に依存するマルチ・ファクターモデルを考える．金融資産$i$の収益率$r_i$は企業特有の部分$\varepsilon_i$と共通要因であるファクター$F_k(k=1,\cdots,m)$によって決定される．また，$\varepsilon_i$は資産間で相互に無相関であると仮定すると，$r_i$は以下のように表される．
\begin{equation}
r_i = \alpha_i + \beta_{i,1}F_1 + \beta_{i,2}F_2 + \cdots + \beta_{i,k}F_k + \cdots + \beta_{i,m}F_m + \varepsilon_i
\label{eq:multifactor}
\end{equation}
ここで，2.1節と同様，資産$i(i=1,\cdots,N)$の保有比率が$w_i$であるようなポートフォリオ$P$の収益率$R_P$を考えると以下のようになる．
\begin{equation}
\begin{split}
R_P &= \alpha_P + \beta_{P,1} F_1 + \beta_{P,2} F_2 + \cdots + \beta_{P,m} F_m + \varepsilon_P\\
&=\sum_{i=1}^N \alpha_i + F_1 \sum_{i=1}^N w_i \beta_{i,1} + \cdots + F_m \sum_{i=1}^N w_i \beta_{i,m} + \sum_{i=1}^N w_i\varepsilon_i\\
&= \sum_{i=1}^N \alpha_i + \sum_{k=1}^m \sum_{i=1}^N w_i \beta_{i,k} F_k + \sum_{i=1}^N w_i\varepsilon_i
\label{eq:multi}
\end{split}
\end{equation}

%次に，式(\ref{eq:multi})の分散を考える．
%ポートフォリオの分散は求めたほうが良いの？

\section{APT}

\subsection{仮定}
APTは式(\ref{eq:multifactor})のように，任意の資産$i$のリターンがマルチ・ファクターモデルで表され，$\varepsilon_i$は資産間で相互で無相関であると仮定される．ただし追加として，各ファクターの期待値が0でなければならない．これは，あらかじめ使用するファクターを正規化することにより解決する．以上APTの仮定についてまとめたものを以下に示した．

\begin{itembox}[l]{APTの仮定}
各資産$i$の収益率は以下のように表される．
\begin{eqnarray}
& r_i = \alpha_i + \beta_{i,1}F_1 + \cdots + \beta_{i,k}F_k + \cdots + \beta_{i,m}F_m + \varepsilon_i\label{eq:APT_return} \\
& E(\varepsilon_i) = 0 \qquad (i=1,2,\cdots,N)\\
& E(F_k) = 0 \qquad (k=1,2,\cdots,m)\\
& Cov(\varepsilon_i, \varepsilon_j) = 0 \qquad (i \neq j) \label{eq:APT_cov}
\end{eqnarray}
\end{itembox}
ここで，式(\ref{eq:APT_return})について期待値を取ると
\begin{equation}
E(r_i) = \alpha_i
\end{equation}
となる．つまり，式(\ref{eq:APT_return})における切片項は資産$i$の期待収益率に相当する．
また，複数の資産で構成されるポートフォリオの収益率は式(\ref{eq:multi})と同様に記述される．さらに式(\ref{eq:APT_cov})により，ポートフォリオが十分な数の資産で構成されるとき，$\varepsilon_P$はないものとみなしてよい．十分に分散化されたポートフォリオの収益は，ファクターに対する感度のベクトル$(\beta_{P,1},\cdots,\beta_{P,m})$によってのみ特徴づけられる．

APTの発想は，市場に裁定機会が存在しないことであった．
この仮定により資産の価格付けが行われる．というのも，
%%%どうする．加筆するか否か%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{APTによる価格付け}


\section{ファクターのリスク・プレミアムの算出}
資産$i$の収益率が式(\ref{eq:multi})で表されているとする．このとき資産を組み合わせて，特定のファクターへの感度のみが1で，その他のファクターへの感度が0になるポートフォリオ（ファクター・ポートフォリオ）を考える ．例えば，第1ファクターのみへの感度が1になるようなポートフォリオを$P_1$とすると，その収益率は
\begin{equation}
R_{P_1} = \alpha_{P_1} + 1\times F_1 + 0\times F_2 + \cdots + 0\times F_m + \varepsilon_{P_1} 
\end{equation}
と表せる．このとき，$\alpha_{P_1}$が第1ファクターのリスク・プレミアムとなる．

一般に，$m$個のファクターを想定すると，単一ファクター・ポートフォリオの収益率ベクトルは
\begin{eqnarray}
& \left(
	\begin{array}{cccc}
	R_{P1}\\
	R_{P2}\\
	\vdots \\
	R_{Pm}
	\end{array}
\right)
=
\left(
	\begin{array}{cccc}
	\alpha_{P1}\\
	\alpha_{P2}\\
	\vdots \\
	\alpha_{Pm}
	\end{array}
\right)
+
\left(
	\begin{array}{cccc}
	1 & 0 & \ldots & 0\\
	0 & 1 & \ldots & 0\\
	\vdots & \vdots & \ddots & \vdots \\
	0 & 0 & \ldots & 1
	\end{array}
\right)
\left(
	\begin{array}{cccc}
	F_1 \\
	F_2 \\
	\vdots \\
	F_m
	\end{array}
\right)
+
\left(
	\begin{array}{cccc}
	\varepsilon_{P1}\\
	\varepsilon_{P2}\\
	\vdots \\
	\varepsilon_{Pm}\\
	\end{array}
\right)\\
\notag \\
& \Leftrightarrow \quad \mbox{\boldmath $R$}_P = \mbox{\boldmath $\alpha$}_P + \mbox{\boldmath $I$}_P\mbox{\boldmath $F$} + \mbox{\boldmath $\varepsilon$}_P
\end{eqnarray}
となる，この単位行列$\mbox{\boldmath $I$}_P$はファクターモデルの係数行列$\mbox{\boldmath $\beta$}$と未知の荷重行列$\mbox{\boldmath $w$}$の積で表現できると仮定する．
次に，各ファクターのリスク・プレミアムを行列計算により求めることを考える．なお2.3節と同様，$N$資産に対する$m$ファクターモデルを考える．第$k(k=1,2,\cdots,m)$ファクターに対する感度のみが1であるポートフォリオを第kファクター・ポートフォリオ$P_k$とし，$P_k$における資産$i$のウェートを$w_{i,k}$とする．さらに，資産$i$の第$k$ファクターへの感度を$\beta_{i,k}$とすると，以下の式(\ref{eq:fp})のようにまとめることが出来る．



\begin{equation}
\left(
	\begin{array}{cccc}
	w_{1,1} & w_{1,2} & \ldots & w_{1,m}\\
	w_{2,1} & w_{2,2} & \ldots & w_{2,m}\\
	\vdots & \vdots & \ddots & \vdots\\
	w_{n,1} & w_{n,2} & \ldots & w_{n,m}
	\end{array}
\right)^{\mathrm{T}}
\left(
	\begin{array}{cccc}
	\beta_{1,1} & \beta_{1,2} & \ldots & \beta_{1,m}\\
	\beta_{2,1} & \beta_{2,2} & \ldots & \beta_{2,m}\\
	\vdots & \vdots & \ddots & \vdots\\
	\beta_{n,1} & \beta_{n,2} & \ldots & \beta_{n,m}\\
	\end{array}
\right)=
\left(
	\begin{array}{cccc}
	1 & 0 & \ldots & 0\\
	0 & 1 & \ldots & 0\\
	\vdots & \vdots & \ddots & \vdots \\
	0 & 0 & \ldots & 1
	\end{array}
\right)
\label{eq:fp}
\end{equation}
式(\ref{eq:fp})左辺の$\beta_{i,k}$による感度行列は式(\ref{eq:multi})により推定されるので，$w_{i,k}$によるウェート行列が求める対象である．感度行列の逆行列を左辺の右からかければ良いことになるが，感度行列の型は$n\times m$であり，正方行列ではない．
しかしこれは一般化逆行列$\bf{B}^\dag$を用いることにより解決する．







\chapter{データ解析}
\section{使用したデータ}
2015年1月$\sim$2017年5月にかけて取得できる，東証一部上場企業の株価と各指数を日次終値の形で取得した．なお，データの取得にはBloomberg端末とMicrosoft ExcelのBloombergアドインを使用し，データ分析はR言語により行った．
\begin{itemize}
\item 投資対象市場の選択について\\
\quad 東証一部上場企業の株式の価格データを使用した．\\
\quad 数々の先行研究により，CAPMだけでなくマルチ・ファクターモデルにおいても市場ポートフォリオが第1の共通要因になることに疑いの余地はない．
そこで分析を行いやすくするため対象ユニバースは一つに絞ることを考え，馴染みの深い日本の東京証券取引所を選択した．
また東証二部や東証マザーズに関して，流動性の不十分性よりマルチ・ファクターモデルが十分な説明力を発揮しない可能性があるため，除外することとした．
また，マルチ・ファクターモデルを最大限活かすために投資先を株式のみとし，コモディティや債券，デリバティブ，ETFなどは利用しなかった．
\item ファクターについて\\
マルチ・ファクターモデルを構成する際，以下のファクターを使用した．
\begin{itemize}
\item マーケット・ファクター\\
東証一部上場銘柄を対象としているため，マーケットファクターとしては東証一部上場銘柄の時価総額を反映しているTOPIXを使用した．マーケットファクターの収益率には対数収益率を用いた．
\item サイズ・ファクター\\
Russell/Nomuraの提供する日本株インデックスで代用した．具体的には，配当を含めないSmall Cap Indexから配当を含めないLarge Cap Indexを引くことにより算出した．さらにその変動をみるために差分を取ったものを使用した．
\item バリュー・ファクター\\
Russell/Nomuraの提供する日本株インデックスで代用した．具体的には，配当を含めないTotal Value Indexから配当を含めないTotal Growth Indexを引くことにより算出した．さらにその変動をみるために差分を取ったものを使用した．
\item 為替ファクター\\
日本円(JPY)の市場価格(対米ドル)を為替ファクターとして使用した．さらにその変動をみるために差分を取ったものを使用した．
\item 市場ボラティリティ・ファクター\\
S\&PがVIXと同様の手法で算出している日本市場の30日インプライド・ボラティリティを使用した．
\end{itemize}
上記のファクターはそれぞれ単位もスケールも異なるので，正規化(平均0分散1に標準化)した後に使用した．\\
\quad 
サイズ・ファクターとバリュー・ファクターについては先行研究が豊富であり，その存在はほぼ確実とされている．
%竹原などによる日本におけるFama-Frenchを参考文献に挙げる
次に為替ファクターであるが，これは日本市場が主にアメリカ市場から影響を受けることに起因する．
%VARモデルによる分析入れる？
マーケット・ファクターが為替ファクターを包含しているのではないか，という疑問は持たれるだろうが，業種や海外進出の有無などによりその感度は銘柄ごとに異なるだろう．
そのため円ドル相場をファクターとして取り入れることとした．
最後にボラティリティ・ファクターについてであるが，これは低ボラティリティ・ファクターとは異なるものである．
というのも投資家たちは市場ボラティリティの大きさに従い，リスクを調整するためにリバランスを行うが，その際に取引が集中する銘柄を検出しようと狙ったものである．
このとき，資産価格はボラティリティの変動というよりもその大きさに影響されると考えられるため，差分を取らずに日経VIX系列を正規化した．\\
%モメンタム・ファクターは取り入れなかった．3カ月間で一つのモデル推定をしたため，アルファが柔軟に吸収してくれる．

\end{itemize}



\section{データのクリーニング・概観}
対象期間とした2015年1月$\sim$2017年5月において，何らかの理由（そもそもまだ起業されていない，上場していない，等）により価格データが欠けている企業が見受けられたため，当該企業を除外した．残った1948企業に対し，さらに対数差分をとることによって各営業日の日次収益率を算出した．

対象銘柄すべての価格推移をプロットすることは冗長であるため割愛した．使用するファクターについてのみ時系列プロットを行い，以下の図\ref{fig:factor_plot}に示した．また，多重共線性などの問題が存在するならばそれを回避するため，散布図とヒストグラム、相関行列を図\ref{fig:factor_cor}にまとめた．図\ref{fig:factor_cor}の対角線上にある図が各ファクターのヒストグラムとカーネル密度、下三角の図がファクター間の散布図、上三角の図がファクター間の相関係数に100を掛けた数値を表している。
%対数収益率について書いたほうがいいのでは

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=15cm]{./fig/factor_plot.png}
		\caption{ファクターの時系列プロット}
		\label{fig:factor_plot}
	\end{center}
\end{figure}

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=15cm]{./fig/factor_cor.png}
		\caption{ファクター間の関係}
		\label{fig:factor_cor}
	\end{center}
\end{figure}

図\ref{fig:factor_cor}のうちTOPIX, Value, Size, JPY$\_$USDはどれも定常のような動きになっていることが分かる。対数差分や差分を取っているこれらの系列がこのような動きを示すことは自然なことであるが、中でもValue, Sizeは時折大きな変動を見せており、従う確率分布が他とは異なる可能性がある。JPY$\_$USDの差分系列は最も変動が安定しており、TOPIXの対数差分系列がその中間ぐらいであると言える。またVIXに関してであるが、ボラティリティの大きさをファクターとして扱いたいために原系列をそのまま(差分などを取らずに)正規化した。そのため明らかに非定常過程になっており、直近半年ほどは非常に低い値をとっていることが分かる。

次に図\ref{fig:factor_cor}を確認する。既に述べたがTOPIX, Value, Sizeは時折大きな変動を見せるため、中心付近で高く裾の広い分布になっている。このことはTOPIX, Value, Size同士の散布図が中心付近に集まっており、十字型の広がりを持つことからも確認できる。図\ref{fig:factor_cor}右上の、ファクター間の相関係数を100倍した数値を確認すると、全体的に低くまとまっているものの、低い相関を持つファクターの組み合わせが存在することが見て取れる。この場合TOPIXとJPY$\_$USD、ValueとSize、TOPIXとSizeである。相関を持つ説明変数を使用しての回帰を行うといわゆる「多重共線性」の問題が発生し、実際以上に決定係数が大きくなってしまうなどの不都合がある。よってファクター全てを使ってのモデル推定は不適当であると考えられ、次節で述べるように、モデルの推定方法に工夫を施す必要がある。
%%%%%%%%%%%どうなの！？！？問題アリ？？？

\section{ファクターモデルの推定}
手に入れやすく扱いやすい日次終値データを対象としていることに加え，時系列データの性質により，推定するパラメータ数に対し十分な標本が得られないという問題がある．
また市場の性質が不変であるとは考えにくく，ゆるやか(もしくは何らかの偶発的なショックにより急激に)変化していくものと思われる．
そのためバックテストも見据え，3カ月分のデータを用いてモデルを推定し，その先1カ月を対象にバックテストを行うこととした．
%3カ月分のデータを使う具体的な理由があれば欲しい

マルチ・ファクターモデルを推定する際，Fama-Frenchの3ファクターモデルやCarhartの4ファクターモデルのような線形モデルだけでなく，非線形モデルも考慮に入れることができる．しかしながら，標本の少なさや時系列データにおける外挿の問題により複雑なモデルを考えるメリット小さく，ここでは線形モデルのみを考えた．

線形でのマルチ・ファクターモデルを推定する際にも注意しなければならないことがある．むやみに説明変数(ここでは各ファクターを指す)を増やすことにより生じる多重共線性の問題や多重性の問題，みせかけの回帰の問題である．そこで，説明変数を全て使用しての線形回帰ではなく，何らかの工夫を施すことによりむやみにモデルを複雑にしない操作が必要になる．選択肢としては以下の手法が考えられる．

\begin{itemize}
\item AICやBICなどの情報量基準を用いたモデル選択
\item リッジ回帰やlasso回帰などの，正則化項を用いたモデル推定
\end{itemize}

最終的にはlasso回帰によるモデル推定を行うこととした．
詳細は割愛するが，AICなどの情報量基準は用いる説明変数をあらかじめ決め，選択された変数に基づいてモデルの良し悪しを示す値を計算することになる．
%ほんとうに割愛していいの？
つまり今回の場合5つのファクターを用いているので，一期間の一銘柄に対し$2^5 = 32$通りのモデル推定を行わなければならない．
全ての銘柄に対し全ての期間でモデル推定を行うと約160万回の推定が必要になる．
これはいわゆる「組み合わせ爆発」の問題であり，計算時間の観点から現実的ではない．
これを回避する手法の一つに変数減少法がある．
始めは全ての変数を用いモデル推定を行い，そこから一つずつ不適切な変数をふるい落としていく手法である．
しかし，変数減少法を用いても局所的極小や過大な計算時間の不安はまぬがれない．

情報量基準の立場に対し，正則化項付きのモデル推定は「あえてすべての変数を使う」という立場にある．
説明変数を「使う」「使わない」のゼロイチで切り捨てる代わりに，全ての係数を少しずつ抑えるという発想の手法である．
具体的には，リッジ回帰では$\sum_i\beta_i^2$に対して，lasso回帰では$\sum_i | \beta_i |$に対して罰則を加えるのである．
この操作により回帰係数が過大になることを防ぎ，なおかつ汎化性能を高めることができる．


\subsection{lasso回帰について}
lasso回帰で罰則を加える$\sum_i | \beta_i |$とリッジ回帰で罰則を加える$\sum_i\beta_i^2$に大差はないように思える．
2乗の$\beta_i^2$を絶対値$|\beta_i|$に置き換えただけであるが，こうすることにより興味深い性質が生まれる．
任意の説明変数がある程度以上「いらない変数」の場合，その係数が小さくなるだけでなく$0$になってしまうのである．
%イメージ図のせる？？
すなわち，係数の過大化を防ぎ汎化性能を高めるだけでなく自動的に「変数選択」を行う能力を持つのである．

以上の理由によりモデル推定にはlasso回帰を用いることとした．$t=1,\cdots,T$の期間において，銘柄$i$のマルチ・ファクターモデルは以下の式を最小化することにより求まる．$\alpha_i$が含まれていないが，これは各推定期間ごとに正規化することによる．
\begin{equation}
\sum_{t=1}^T\left(r_{i,t} - \sum_{k=1}^5\beta_{i,k}F_{k,t} \right)^2 + \lambda_i\sum_{k=1}^5|\beta_{i,k}|
\end{equation}
問題は正則化項のパラメータ$\lambda_i$に関してであるが，これは交差検証法によって最小二乗誤差が最小の値を使用する．今回の分析では交差検証法の分割を全て10とした．


%最適化の話かく？？？
\section{リスク・プレミアム}
過去3ヶ月のデータより推定したマルチ・ファクターモデルに基づいて算出したリスク・プレミアムを以下の図\ref{fig:riskpremium}に示した。具体的には，2.6節の式(\ref{eq:fp})を一般化逆行列を利用することによりファクター・ポートフォリオを推定し，その期待超過収益率をファクターのリスク・プレミアムとした．

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=15cm]{./fig/riskpremium.png}
		\caption{リスク・プレミアムの推移}
		\label{fig:riskpremium}
	\end{center}
\end{figure}
\section{様々なポートフォリオ}
3
3.3節で各銘柄のファクターモデルを推定し、3.4節にではファクターごとのリスク・プレミアムを算出した。
この節では様々なポートフォリオを構築し、バックテストでその性能を確かめると同時に、マルチ・ファクターモデルにおけるリスク・プレミアムが真に価値を持ったものなのかどうかを確かめる。なお、バックテストにおけるリバランスはコンテストを想定し、毎月初に行うこととした。
つまり，3カ月間のデータで推定したマルチ・ファクターモデルを用いてオーとフォリオを構成し，その先1か月でバックテストを行うということである．
そのイメージ図を以下の図\ref{fig:backtest}に示した．

\begin{figure}[H]
	\begin{center}
		\includegraphics[width=15cm]{./fig/backtest.png}
		\caption{バックテストのイメージ図}
		\label{fig:backtest}
	\end{center}
\end{figure}

\subsection{各ベータの上位30銘柄による等加重ポートフォリオ}
直近3ヶ月のデータより推定したマルチ・ファクターモデルの各係数(ベータ)の上位30銘柄で等加重ポートフォリオを作成した。また、その累計リターンの推移を以下の図\ref{fig:factor_top30}に示した。また、マーケットに対してのアウトパフォームを確認するために、ＴＯＰＩＸの累計リターンをbenchmarkとして共に示した。


\begin{figure}[H]
	\begin{center}
		\includegraphics[width=15cm]{./fig/factor_top30.png}
		\caption{各ベータ上位30銘柄による等加重ポートフォリオ}
		\label{fig:factor_top30}
	\end{center}
\end{figure}


図\ref{fig:factor_top30}より、どのポートフォリオも似たような動きをしており、マーケット・ファククターの影響力が非常に大きいことが分かる。しかし全てのファクター・ベータについての上位30銘柄のポートフォリオはベンチマークをアウトパフォームしており、マーケット・ファクターだけでは説明のつかないアノマリーの存在をマルチ・ファクターモデルによって抜き出せたことが確認できた。

\section{ポートフォリオ選択}
リスク・プレミアムを算出したことによりファクターごとのリスクを取る価値が定量化できたが、ポートフォリオの構成銘柄は10$\sim$30銘柄でなくてはならない。銘柄数を考慮しなければ、リスクプレミアムの合計を目的関数とした最適化問題を考えればよいことになる。

ポートフォリオの収益率ファクターに対する感度は2.2節の式(\ref{eq:multi})により与えられていた。今回は5ファクターモデルを考えているため、ポートフォリオの収益は次のように与えられる。
\begin{equation}
\begin{split}
R_P &= \alpha_P + \beta_{P,1} F_1 + \beta_{P,2} F_2 + \cdots + \beta_{P,5} F_m + \varepsilon_P\\
&=\sum_{i=1}^N \alpha_i + F_1 \sum_{i=1}^N w_i \beta_{i,1} + \cdots + F_5 \sum_{i=1}^N w_i \beta_{i,m} + \sum_{i=1}^N w_i\varepsilon_i\\
&= \sum_{i=1}^N \alpha_i + \sum_{k=1}^5 \sum_{i=1}^N w_i \beta_{i,k} F_k + \sum_{i=1}^N w_i\varepsilon_i
\label{eq:port}
\end{split}
\end{equation}
いま、ファクター$F_1,\cdots,F_5$のリスク・プレミアムが$\lambda_1,\cdots,\lambda_5$で与えられているとすると、ファクターのリスク・プレミアムを重みとした以下の最適化問題を考えるのが自然である。

\begin{equation}
\begin{split}
\text{maximize : }\quad & \beta_{P,1}\lambda_1 + \beta_{P,2}\lambda_2 + \beta_{P,3}\lambda_3 + \beta_{P,4}\lambda_4 + \beta_{P,5}\lambda_5\\
& = \sum_{k=1}^5 \sum_{i=1}^N w_i \beta_{i,k} F_k\\
\text{subject to : }\quad & \sum_{i=1}^N w_i = 1\\
& w_i \geq 0\qquad(i=1,\cdots,N)
\end{split}
\label{eq:port_optim}
\end{equation}
式(\ref{eq:port_optim})の最適化問題のうち、$F_k, \beta_{i,k}$は推定済みであり、$w_i$のみが変数である。よってこれは線形計画問題とな
り、シンプレックス法などのアルゴリズムにより簡単に解くことができる。

次に銘柄数を考慮する。10$\sim$30銘柄に絞り込まなければならないので、銘柄$i$がポートフォリオに組み込まれた場合に1を，そうでない場合は0を示す変数$x_i$を導入することで以下のように定式化できる。

\begin{equation}
\begin{split}
\text{maximize : }\quad & \beta_{P,1}\lambda_1 + \beta_{P,2}\lambda_2 + \beta_{P,3}\lambda_3 + \beta_{P,4}\lambda_4 + \beta_{P,5}\lambda_5\\
& = \sum_{k=1}^5 \sum_{i=1}^N w_i \beta_{i,k} \lambda_k\\
\text{subject to : }\quad & \sum_{i=1}^N w_i = 1\\
& w_i \geq 0\qquad(i=1,\cdots,N)\\
&10 \leq \sum_{i=1}^Nx_i \leq 30
\end{split}
\label{eq:port_optim}
\end{equation}

最後の式が加わったことにより，厳密解を求めることは非常に難しくなった．そこで，特定の最適化問題に依存しないメタ・ヒューリスティクスによる解法が考えられるが，計算量が多く，全ての期間でのバックテストが間に合わなかった．そのため，以下の手法によるポートフォリオ選択を考えた．

\begin{itembox}[l]{ポートフォリオ選択の手順}
\begin{enumerate}
\item 直近3ヶ月のデータより推定したファクターごとのリスク・プレミアムのうち、最もプレミアムの大きいファクターへの感度が高いもの上位100銘柄を選択する。
\item 1で選択した100銘柄のうち、直近3ヶ月のモメンタムが高い30銘柄を選択
\item 2で選択した30銘柄により等加重ポートフォリオを構成
\end{enumerate}
\end{itembox}

\chapter{途中経過}
\section{提出したポートフォリオ}

\begin{table}[H]
\begin{center}
\begin{tabular}{|c|c|c|}
\hline
企業名 & ウェート(\%) & 時価総額(円, 7月3日時点)\\
\hline
\hline
グローブライド	&3.34&3,343,642\\
コメダホールディングス&3.33	&3,335,200\\
ゼンショーホールディングス&3.33&	3,339,875\\
三井ホーム&3.33&3,333,333\\
井筒屋&3.33	&3,341,014\\
日成ビルド工業&3.35&3,360,302\\
美津濃&3.28	&3,287,108\\
藤倉ゴム工業	&	3.36	&	3,369,011	\\
近鉄百貨店	&	3.35	&	3,352,435	\\
ＧＳＩクレオス	&	3.30	&	3,309,523	\\
イマジカ・ロボット・ホールディングス	&	3.34	&3,351,877\\
グランディハウス	&	3.30	&	3,309,859	\\
サンフロンティア不動産	&	3.43	&	3,432,881	\\
北陸電力	&	3.32	&	3,326,772	\\
アイ・オー・データ機器	&	3.35	&	3,360,768	\\
アドソル日進	&	3.36	&	3,363,838	\\
システムリサーチ	&	3.36	&	3,363,148	\\
ルネサスイーストン	&	3.36	&	3,367,816	\\
日本電波工業	&	3.36	&	3,363,984	\\
ソフトクリエイトホールディングス	&	3.35	&3,361,324\\
カワチ薬品	&	3.35	&	3,353,240	\\
三井製糖	&	3.39	&	3,395,734	\\
六甲バター	&	3.30	&	3,305,533	\\
森永乳業	&	3.23	&	3,234,511	\\
養命酒製造	&	3.31	&	3,317,285	\\
ニチハ	&	3.34	&	3,350,168	\\
三井住友建設	&	3.30	&	3,306,233	\\
太平洋興発	&	3.33	&	3,333,333	\\
極東証券	&	3.28	&	3,285,697	\\
ＳＯＭＰＯホールディングス	&	3.35	&	3,353,441\\
\hline
\hline
合計& 100.00 &  100,208,884\\
\hline
\end{tabular}
\end{center}
\caption{提出したポートフォリオ}
\label{tbl:port1}
\end{table}
\section{7月中のパフォーマンス}
\chapter{今後の課題}
1回目のポートフォリオ提出に間に合わなかった分析や、提出後に浮かんできた疑問点、考えうる批判など数々の課題がある。ここではそれらを列挙し、考察していく。

\begin{itemize}
\item{データに関する問題}\\
\quad 3.1節で述べたように、2015年からの日次データを取得した。この取得を日次ではなく、前場の終値、後場の終値ごとに取得すれば絶対的に標本数が増え、より精度の高い分析が行えるだろう。
\item{ファクター選択に関する問題}\\
\quad 今回のリサーチでは、3.1節で述べたように使用するファクターを選択した。
その存在が確実といわれるファクターだけでなく、独自のファクターを定性的な理由により取り入れた。
しかし3.2節で述べたように、正規化したファクター間には弱い相関が存在するものがあった。
多重共線性を回避し、汎化性能を高めるためにモデル選択では工夫をしたが、ファクター間に包含関係がある可能性は依然として残ったままである。
本来ファクター同士は直交していることが望ましく、統計的な因果推論などを行い適切なファクターの組み合わせ選択を行う必要性があるだろう。

\item{マルチ・ファクターモデル推定に関する問題}\\
\quad 3.2節で述べたように、マルチ・ファクターモデルの推定では工夫をした。
銘柄の中には、lassoによってマーケット・ファクターやサイズ・ファクターなど、その存在が確実とされているファクターへの感度が$0$と推定されたものがあった。
説明力や汎化性能を高めるためとはいえ、このように絶対的なファクターを蔑ろにしてしまうことには議論の余地があるだろう。

\quad また、モデル推定に用いたデータは直近3ヶ月間のものであり、1ヶ月単位で(1月$\sim$3月、2月$\sim$4月、というような)推定を行った。例えばこの期間を2ヶ月間、4ヶ月間、5ヶ月間と変更し同様の作業を行うことで、どのような変化があるのか検証する必要がある。さらに推定を1ヶ月単位で行うのではなく、1日単位で行った場合に関しても検証する必要があるだろう。
\item{リスク・プレミアム推定に関する問題}\\
\quad 上記のように1日単位でモデル推定を行うことにより、それに基づく各ファクターのリスク・プレミアムの推移はより滑らかになることが考えられる。
たとえそうでなかったとしても、データの数が増えることにより新たな発見につながると予想できる。

\quad また、ボラティリティ・ファクターのプレミアムの分散は他に比べて非常に大きいものとなっていた。このことは直感に反しており、さらに考察をしていく必要があると感じた。さらに、ファクターのリスク・プレミアム同士がお互いに影響を及ぼしているかについても分析することが出来るだろう。
\item{ポートフォリオ選択に関して}\\
\quad 3.5節のように、ファクターのリスク・プレミアムに基づいて銘柄ごとのリスク・プレミアムを算出し、上位30銘柄によるポートフォリオを構築した。
しかしバックテストにおけるそのリターンは思わしくなく、予想とは異なる結果であり、追加の考察が必要であると感じた。

\end{itemize}


\begin{thebibliography}{30}
	\bibitem{analyst} 小林孝雄，芹田敏夫，日本証券アナリスト協会『新・証券投資理論I 理論篇』（日本経済新聞出版社，2009）
	\bibitem{finance} デービッド・G・ルーエンバーガー『金融工学入門』（日本経済新聞社，2002）
	\bibitem{Basu} Basu, S. ''Investment Performance of Commin Stocks in Relation to their Price-Earnings Ratios'', Journal of Finance, 663-682(1977)
	\bibitem{Banz} Banz, Rolf W. ''The relationship between return and market value of common stock'', Journal of Financial Economics, 3-18(1981)
	\bibitem{Fama} Fama, E.F. and K.R. French ''Common risk factors in the returns on stocks and bonds'', Journal of Financial Economics, 33(1993)
	\bibitem{Jagadeesh} Jagadeesh, N. and Titman, S. ''Returns to Buying Winners and Selling Losers: Implications for Stock Market Efficiency.'', Journal of Finance 48(1993)
	\bibitem{Ross} Ross, S. ''The Arbitrage Theory of Capital Asset Pricing'', Journal of Economic Theory 13(1976)
	
\end{thebibliography}
\end{document}